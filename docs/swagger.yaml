openapi: 3.0.0
info:
  title: API de Gestion des Tâches
  description: |
    
    Cette API permet de :
    - Créer un compte et se connecter (avec validation de mot de passe renforcée)
    - Gérer des tâches (créer, modifier, supprimer)
    - Ajouter des collaborateurs sur vos tâches
    
    ## Validation du mot de passe
    Le mot de passe doit contenir :
    - Au moins 8 caractères
    - Au moins 1 majuscule
    - Au moins 1 minuscule
    - Au moins 1 chiffre
    - Au moins 1 caractère spécial (!@#$%^&*(),.?":{}|<>)
    
    ## Comment utiliser l'authentification ?
    1. Créez un compte avec /api/auth/signup
    2. Connectez-vous avec /api/auth/login (vous recevrez un token)
    3. Cliquez sur le bouton "Authorize" en haut
    4. Collez votre token dans le champ (sans "Bearer")
    5. Maintenant vous pouvez tester toutes les routes protégées !
    
  version: 2.0.0
  contact:
    name: Support API
    email: support@example.com

servers:
  - url: http://localhost:3000
    description: Serveur local de développement

tags:
  - name: Authentification
    description: Créer un compte, se connecter, se déconnecter
  - name: Utilisateurs
    description: Gérer les utilisateurs
  - name: Tâches
    description: Créer et gérer vos tâches
  - name: Collaborateurs
    description: Ajouter des personnes sur vos tâches

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Entrez votre token JWT ici.
        Le token expire après 15 minutes.
        Utilisez /api/auth/refresh pour le renouveler.

  schemas:
    Utilisateur:
      type: object
      properties:
        id:
          type: integer
          description: Identifiant unique de l'utilisateur
          example: 1
        name:
          type: string
          description: Nom de l'utilisateur
          example: Jean Dupont
        is_login:
          type: boolean
          description: Est-ce que l'utilisateur est connecté ?
          example: true

    Tache:
      type: object
      properties:
        id:
          type: integer
          description: Identifiant unique de la tâche
          example: 1
        name:
          type: string
          description: Nom de la tâche
          example: Créer une application
        description:
          type: string
          description: Description détaillée
          example: Développer une application de todo list
        is_done:
          type: boolean
          description: La tâche est-elle terminée ?
          example: false
        userId:
          type: integer
          description: ID du propriétaire de la tâche
          example: 1
        collaboratorId:
          type: array
          description: Liste des IDs des collaborateurs
          items:
            type: integer
          example: [2, 3]

    Erreur:
      type: object
      properties:
        error:
          type: string
          description: Message d'erreur
          example: Une erreur est survenue

paths:
  # ==================== AUTHENTIFICATION ====================
  
  /api/auth/signup:
    post:
      summary: Créer un nouveau compte
      description: |
        Permet à un nouvel utilisateur de s'inscrire.
        
        **Validation du mot de passe :**
        - Minimum 8 caractères
        - Au moins 1 majuscule (A-Z)
        - Au moins 1 minuscule (a-z)
        - Au moins 1 chiffre (0-9)
        - Au moins 1 caractère spécial (!@#$%^&*(),.?":{}|<>)
        
        Exemples valides : `Abcde123@`, `Test123!`, `MyPass2024#`
      tags:
        - Authentification
      requestBody:
        required: true
        description: Informations pour créer le compte
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - password
              properties:
                name:
                  type: string
                  description: Nom d'utilisateur (doit être unique)
                  example: Jean
                  minLength: 1
                password:
                  type: string
                  format: password
                  description: Mot de passe (sera crypté avec bcrypt)
                  example: MonPass123@
                  minLength: 8
            examples:
              exemple_valide:
                summary: Exemple valide
                value:
                  name: "Jean"
                  password: "Secure123@"
              exemple_invalide:
                summary: Mot de passe trop faible (sera rejeté)
                value:
                  name: "Jean"
                  password: "123456"
      responses:
        '201':
          description: Compte créé avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Utilisateur créé avec succès
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      name:
                        type: string
                        example: Jean
        '400':
          description: Données invalides ou mot de passe non conforme
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              examples:
                champs_manquants:
                  summary: Champs manquants
                  value:
                    error: Nom et mot de passe requis
                password_invalide:
                  summary: Mot de passe non conforme
                  value:
                    error: Le mot de passe doit contenir au moins 8 caractères, 1 majuscule, 1 minuscule, 1 chiffre et 1 caractère spécial
        '409':
          description: Ce nom d'utilisateur existe déjà
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Utilisateur déjà existant
        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Erreur serveur

  /api/auth/login:
    post:
      summary: Se connecter
      description: |
        Connectez-vous pour recevoir vos tokens d'accès.
        
        **Tokens retournés :**
        - `accessToken` : Valide 15 minutes, à utiliser pour toutes les requêtes
        - `refreshToken` : Valide 7 jours, pour renouveler l'accessToken
      tags:
        - Authentification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - password
              properties:
                name:
                  type: string
                  example: Jean
                password:
                  type: string
                  format: password
                  example: MonPass123@
      responses:
        '200':
          description: Connexion réussie - Utilisez le accessToken pour les autres requêtes
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Connexion réussie
                  accessToken:
                    type: string
                    description: Token à utiliser pour les requêtes (expire dans 15min)
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  refreshToken:
                    type: string
                    description: Token pour renouveler l'accessToken (expire dans 7 jours)
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      name:
                        type: string
                        example: Jean
        '400':
          description: Champs manquants
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Nom et mot de passe requis
        '401':
          description: Nom d'utilisateur ou mot de passe incorrect
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Identifiants invalides
        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'

  /api/auth/refresh:
    post:
      summary: Renouveler le token d'accès
      description: |
        Utilisez votre refreshToken pour obtenir un nouveau accessToken.
        Utile quand votre accessToken a expiré (après 15 minutes).
      tags:
        - Authentification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  description: Le refreshToken reçu lors de la connexion
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Nouveau token généré
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    description: Nouveau token d'accès (valide 15 min)
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '401':
          description: Refresh token manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Refresh token requis
        '403':
          description: Token invalide ou expiré
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Refresh token invalide ou expiré
        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'

  /api/auth/logout:
    post:
      summary: Se déconnecter
      description: |
        Déconnectez-vous et invalidez votre refreshToken.
        Le refreshToken sera supprimé de la base de données.
      tags:
        - Authentification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Déconnexion réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Déconnexion réussie
        '400':
          description: Refresh token manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Refresh token requis
        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'

  # ==================== UTILISATEURS ====================
  
  /api/users:
    get:
      summary: Voir tous les utilisateurs
      description: |
        Récupère la liste complète des utilisateurs enregistrés.
        Route publique (pas besoin d'authentification).
      tags:
        - Utilisateurs
      responses:
        '200':
          description: Liste récupérée
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Utilisateur'
              example:
                - id: 1
                  name: Jean
                  is_login: true
                - id: 2
                  name: Bob
                  is_login: false
        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'

  /api/users/{id}:
    put:
      summary: Modifier mon profil
      description: |
        Vous ne pouvez modifier que VOTRE propre profil.
        L'ID dans l'URL doit correspondre à votre ID utilisateur (dans le token).
      tags:
        - Utilisateurs
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Votre ID utilisateur
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  description: Votre nouveau nom
                  example: Jean Nouveau
                  minLength: 1
      responses:
        '200':
          description: Profil modifié
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  name:
                    type: string
                    example: Jean Nouveau
                  is_login:
                    type: boolean
                    example: true
        '400':
          description: Nom manquant ou invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Le nom est requis
        '401':
          description: Token manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Token requis
        '403':
          description: Vous ne pouvez modifier que votre propre profil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Vous ne pouvez modifier que votre propre profil
        '404':
          description: Utilisateur non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Utilisateur non trouvé

    delete:
      summary: Supprimer un utilisateur
      description: |
        Supprime un utilisateur de la base de données.
        ⚠️ Cette action est irréversible.
      tags:
        - Utilisateurs
      parameters:
        - name: id
          in: path
          required: true
          description: ID de l'utilisateur à supprimer
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Utilisateur supprimé
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Utilisateur supprimé
        '404':
          description: Utilisateur non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Utilisateur non trouvé
        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'

  # ==================== TÂCHES ====================
  
  /api/tasks:
    get:
      summary: Voir mes tâches
      description: |
        Affiche toutes les tâches où vous êtes propriétaire OU collaborateur.
        Les tâches sont stockées en base de données SQLite.
      tags:
        - Tâches
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Voici vos tâches
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tache'
              example:
                - id: 1
                  name: Projet1
                  description: Développer un jeu
                  is_done: false
                  userId: 1
                  collaboratorId: [2]
                - id: 2
                  name: Projet2
                  description: Site web
                  is_done: false
                  userId: 2
                  collaboratorId: []
        '401':
          description: Vous devez être connecté
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Token requis
        '403':
          description: Token invalide ou expiré
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Token invalide ou expiré
        '500':
          description: Erreur serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'

    post:
      summary: Créer une nouvelle tâche
      description: |
        Créez une tâche dont vous serez le propriétaire.
        Vous pourrez ensuite ajouter des collaborateurs.
      tags:
        - Tâches
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
              properties:
                name:
                  type: string
                  description: Nom de la tâche
                  example: Mon nouveau projet
                  minLength: 1
                description:
                  type: string
                  description: Description détaillée
                  example: Créer une application mobile
                  minLength: 1
      responses:
        '201':
          description: Tâche créée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tache'
              example:
                id: 3
                name: Mon nouveau projet
                description: Créer une application mobile
                is_done: false
                userId: 1
                collaboratorId: []
        '400':
          description: Nom et description requis
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Nom et description requis
        '401':
          description: Token manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'

  /api/tasks/{id}:
    put:
      summary: Modifier une tâche
      description: |
        Modifiez une tâche si vous êtes propriétaire OU collaborateur.
        Tous les champs sont optionnels.
      tags:
        - Tâches
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID de la tâche à modifier
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Projet1 modifié
                description:
                  type: string
                  example: Nouvelle description
                is_done:
                  type: boolean
                  description: Marquer comme terminée ?
                  example: true
            examples:
              modifier_nom:
                summary: Modifier le nom uniquement
                value:
                  name: "Nouveau nom"
              marquer_termine:
                summary: Marquer comme terminée
                value:
                  is_done: true
              modification_complete:
                summary: Modifier plusieurs champs
                value:
                  name: "Projet terminé"
                  description: "Tous les objectifs sont atteints"
                  is_done: true
      responses:
        '200':
          description: Tâche modifiée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tache'
        '401':
          description: Token manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
        '403':
          description: Vous n'avez pas accès à cette tâche
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: "Accès refusé : vous n'avez pas les droits sur cette tâche"
        '404':
          description: Tâche non trouvée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: Tâche non trouvée

    delete:
      summary: Supprimer une tâche
      description: |
        Seul le propriétaire peut supprimer une tâche.
        Les collaborateurs ne peuvent pas supprimer.
        ⚠️ Cette action est irréversible.
      tags:
        - Tâches
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID de la tâche à supprimer
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Tâche supprimée
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Tâche supprimée
        '401':
          description: Token manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
        '403':
          description: Seul le propriétaire peut supprimer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: "Action refusée : seul le propriétaire peut supprimer cette tâche"
        '404':
          description: Tâche non trouvée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'

  # ==================== COLLABORATEURS ====================
  
  /api/tasks/{id}/collaborators:
    post:
      summary: Ajouter un collaborateur
      description: |
        Ajoutez quelqu'un pour travailler avec vous sur cette tâche.
        
        **Restrictions :**
        - Seul le propriétaire peut ajouter des collaborateurs
        - Le propriétaire ne peut pas être ajouté comme collaborateur
        - Un utilisateur ne peut être ajouté qu'une seule fois
      tags:
        - Collaborateurs
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID de la tâche
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
              properties:
                userId:
                  type: integer
                  description: ID de l'utilisateur à ajouter
                  example: 2
      responses:
        '200':
          description: Collaborateur ajouté
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Collaborateur ajouté
        '400':
          description: Erreur (utilisateur déjà collaborateur, propriétaire, ID manquant, etc.)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              examples:
                deja_collaborateur:
                  summary: Utilisateur déjà collaborateur
                  value:
                    error: Cet utilisateur est déjà collaborateur
                proprietaire:
                  summary: Le propriétaire ne peut pas être collaborateur
                  value:
                    error: Le propriétaire ne peut pas être ajouté comme collaborateur
                id_manquant:
                  summary: ID utilisateur manquant
                  value:
                    error: ID utilisateur requis
        '401':
          description: Token manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
        '403':
          description: Seul le propriétaire peut ajouter des collaborateurs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: "Action refusée : seul le propriétaire peut ajouter des collaborateurs"
        '404':
          description: Tâche ou utilisateur non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              examples:
                tache_non_trouvee:
                  summary: Tâche non trouvée
                  value:
                    error: Tâche non trouvée
                utilisateur_non_trouve:
                  summary: Utilisateur non trouvé
                  value:
                    error: Utilisateur non trouvé

  /api/tasks/{id}/collaborators/{userId}:
    delete:
      summary: Retirer un collaborateur
      description: |
        Retirez un collaborateur de votre tâche.
        Seul le propriétaire peut retirer des collaborateurs.
      tags:
        - Collaborateurs
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID de la tâche
          schema:
            type: integer
            example: 1
        - name: userId
          in: path
          required: true
          description: ID du collaborateur à retirer
          schema:
            type: integer
            example: 2
      responses:
        '200':
          description: Collaborateur retiré
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Collaborateur retiré
        '401':
          description: Token manquant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
        '403':
          description: Seul le propriétaire peut retirer des collaborateurs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              example:
                error: "Action refusée : seul le propriétaire peut retirer des collaborateurs"
        '404':
          description: Tâche ou collaborateur non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Erreur'
              examples:
                tache_non_trouvee:
                  summary: Tâche non trouvée
                  value:
                    error: Tâche non trouvée
                collaborateur_non_trouve:
                  summary: Collaborateur non trouvé sur cette tâche
                  value:
                    error: Collaborateur non trouvé sur cette tâche

                    
 # ==================== GOOGLE CALENDAR ====================
  
  /api/calendar/events:
    post:
      summary:  Créer un événement dans Google Calendar
      description: |
        Crée automatiquement un événement dans ton Google Calendar.
        Pratique pour synchroniser tes tâches avec ton agenda !
      tags: [Calendar]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [summary, startDateTime, endDateTime]
              properties:
                summary:
                  type: string
                  description: Titre de l'événement
                  example: "Réunion client Important"
                description:
                  type: string
                  description: Description de l'événement
                  example: "Présentation du nouveau produit"
                startDateTime:
                  type: string
                  format: date-time
                  description: Date et heure de début (format ISO 8601)
                  example: "2024-12-15T14:00:00"
                endDateTime:
                  type: string
                  format: date-time
                  description: Date et heure de fin
                  example: "2024-12-15T15:00:00"
                location:
                  type: string
                  description: Lieu de l'événement
                  example: "10 Rue de la Paix, Paris"
      responses:
        '201':
          description: Événement créé dans Google Calendar
          content:
            application/json:
              example:
                message: "Événement créé dans Google Calendar"
                event:
                  id: "abc123xyz"
                  htmlLink: "https://www.google.com/calendar/event?eid=..."
                  summary: "Réunion client Important"
                  start:
                    dateTime: "2024-12-15T14:00:00+01:00"
                  end:
                    dateTime: "2024-12-15T15:00:00+01:00"
        '500':
          description:  Erreur lors de la création

  /api/calendar/events/{eventId}:
    get:
      summary: Récupérer un événement
      tags: [Calendar]
      security:
        - BearerAuth: []
      parameters:
        - name: eventId
          in: path
          required: true
          description: ID de l'événement Google Calendar
          schema:
            type: string
            example: "abc123xyz"
      responses:
        '200':
          description: Événement trouvé
        '404':
          description: Événement non trouvé

    delete:
      summary: Supprimer un événement
      tags: [Calendar]
      security:
        - BearerAuth: []
      parameters:
        - name: eventId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Événement supprimé

tags:
  - name: Calendar
    description: Synchronisation avec Google Calendar